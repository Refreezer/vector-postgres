{
  "nodes": [
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏—è –æ –≤–æ—Ä–æ–Ω–∫–∞—Ö –ø—Ä–æ–¥–∞–∂",
        "tableName": "funnel_types",
        "topK": 3,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        2512,
        592
      ],
      "id": "4081e630-b9ff-4ed5-b006-839724ba2739",
      "name": "Postgres PGVector Store",
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -288,
        1392
      ],
      "id": "40f727d0-5ea0-4c1e-8553-d4f36b55187a",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "mrmnOe1SW7Qiuamb",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": "funnel_types",
        "embeddingBatchSize": 1,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        -288,
        1168
      ],
      "id": "1df68b7d-ad85-485c-a57f-9cc0414bfe03",
      "name": "Postgres PGVector Store1",
      "credentials": {
        "postgres": {
          "id": "0lNa5njGWb8wLXvC",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.funnel_types.funnel_data.info.description }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        -160,
        1392
      ],
      "id": "6d6468d1-aad4-4a60-bdbc-aacf9494dd8f",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "fieldToSplitOut": "funnel_types",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -736,
        1168
      ],
      "id": "befc27d7-8e37-4fba-a265-16de3c8bc1e5",
      "name": "Split Out"
    },
    {
      "parameters": {
        "operation": "fromJson",
        "binaryPropertyName": "funnel_types",
        "destinationKey": "funnel_types",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -960,
        1168
      ],
      "id": "c16efd04-8461-4538-9be3-4bc9825d749d",
      "name": "Extract from File"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e045c0b7-219d-48ce-8523-18848f8bf3f0",
              "name": "funnel_types.funnel_data.info.description",
              "value": "={{ $json.funnel_types.funnel_data.type }}:\n{{ $json.funnel_types.funnel_data.info.description }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -512,
        1168
      ],
      "id": "4efeb94b-e99a-49a9-9ae2-c0cb38b40022",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "completion",
        "completionTitle": "–°–ø–∞—Å–∏–±–æ!",
        "completionMessage": "–ú—ã –ø–æ–ª—É—á–∏–ª–∏ –≤–∞—à –±—Ä–∏—Ñ.  \nAI —É–∂–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã üöÄ",
        "options": {}
      },
      "type": "n8n-nodes-base.form",
      "typeVersion": 2.3,
      "position": [
        -960,
        656
      ],
      "id": "d0d7e5aa-3e83-4945-8698-997ebe5a736b",
      "name": "Form",
      "webhookId": "cafbc50f-a8a2-4335-9fa8-d1b5a44cde3b"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "=–ó–∞–ø–æ–ª–Ω–∏—Ç–µ [—Ñ–æ—Ä–º—É](https://vps-af079087.vps.ovh.net/n8n/form/5f8eaf12-5bd2-4bae-b794-8aaf52ddd3f6?chat_id={{ $json.chat_id }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -288,
        464
      ],
      "id": "560513ee-b44c-4a9f-96c4-7f4112906a41",
      "name": "send_brief_form_link",
      "webhookId": "9cd4fd56-9888-4ae3-a828-7938a83cf2b2",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO public.session_state (chat_id, events)\nVALUES (\n  {{ $json.result.chat.id }},\n  ('[ { \"event_type\": \"TG_CHAT_FUNNELS_BRIEF_FORM_REQUESTED\", \"payload\": { \"url\":' || '{{ JSON.stringify($json.result.entities[0].url) }}' || ' } } ]')::jsonb\n)\nON CONFLICT (chat_id) DO UPDATE\nSET events = session_state.events || EXCLUDED.events,\n    updated_at = CURRENT_TIMESTAMP\n;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -64,
        544
      ],
      "id": "016e0281-b6ab-4643-af85-d17e3913e318",
      "name": "TG_CHAT_FUNNELS_BRIEF_FORM_REQUESTED",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1184,
        112
      ],
      "id": "1ff536d3-570c-4d02-86eb-98acbdd86c42",
      "name": "TG_MESSAGE_RECEIVED",
      "webhookId": "1d03a694-fcd2-4811-b75e-8be87fafe804",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO public.session_state (chat_id, events)\nVALUES (\n  {{ $json.chat_id }},\n  $json_payload$\n    {{\n      JSON.stringify($json)\n    }}\n    $json_payload$::jsonb\n)\nON CONFLICT (chat_id) DO UPDATE\nSET events = session_state.events || EXCLUDED.events,\n    updated_at = CURRENT_TIMESTAMP;\nSELECT {{ $json.chat_id }}  as chat_id, events FROM public.session_state WHERE chat_id = {{ $json.chat_id }} ;\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -288,
        656
      ],
      "id": "3ec70b82-f4c2-4e73-b546-18211d29fa1b",
      "name": "TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        496,
        1008
      ],
      "id": "dc6d0ca7-46bb-49ba-8b77-7152ec7ad7b1",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "mrmnOe1SW7Qiuamb",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"title\": \"Survey Result Schema\",\n  \"type\": \"object\",\n  \"required\": [\n    \"survey_interation\",\n    \"questions_to_ask\",\n    \"result\"\n  ],\n  \"properties\": {\n    \"survey_interation\": {\n      \"type\": \"integer\",\n      \"description\": \"The iteration number of the survey.\"\n    },\n    \"questions_to_ask\": {\n      \"type\": \"array\",\n      \"description\": \"A list of questions to ask the user again due to previous invalid answers.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"required\": [\n          \"text\",\n          \"previous_answer\"\n        ],\n        \"properties\": {\n          \"text\": {\n            \"type\": \"string\",\n            \"description\": \"The follow-up question text.\"\n          },\n          \"previous_answer\": {\n            \"type\": \"string\",\n            \"description\": \"The user's previous, unsatisfactory answer.\"\n          }\n        }\n      }\n    },\n    \"result\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"is_survey_passed\",\n        \"answers\"\n      ],\n      \"properties\": {\n        \"is_survey_passed\": {\n          \"type\": \"boolean\",\n          \"description\": \"Indicates if the survey was successfully passed.\"\n        },\n        \"answers\": {\n          \"type\": \"object\",\n          \"required\": [\n            \"brief_content\"\n          ],\n          \"properties\": {\n            \"brief_content\": {\n              \"type\": \"object\",\n              \"required\": [\n                \"cost\",\n                \"niche\",\n                \"chat_id\",\n                \"product\",\n                \"audience\",\n                \"target_channels\",\n                \"competitors_urls\",\n                \"marketing_budget\"\n              ],\n              \"properties\": {\n                \"cost\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                    \"value\": { \"type\": \"string\" },\n                    \"description\": { \"type\": \"string\" },\n                    \"question\": { \"type\": \"string\" }\n                  },\n                  \"required\": [\"value\", \"description\", \"question\"]\n                },\n                \"niche\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                    \"value\": { \"type\": \"string\" },\n                    \"description\": { \"type\": \"string\" },\n                    \"question\": { \"type\": \"string\" }\n                  },\n                  \"required\": [\"value\", \"description\", \"question\"]\n                },\n                \"chat_id\": {\n                  \"type\": \"string\"\n                },\n                \"product\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                    \"value\": { \"type\": \"string\" },\n                    \"description\": { \"type\": \"string\" },\n                    \"question\": { \"type\": \"string\" }\n                  },\n                  \"required\": [\"value\", \"description\", \"question\"]\n                },\n                \"audience\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                    \"value\": { \"type\": \"string\" },\n                    \"description\": { \"type\": \"string\" },\n                    \"question\": { \"type\": \"string\" }\n                  },\n                  \"required\": [\"value\", \"description\", \"question\"]\n                },\n                \"target_channels\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                    \"value\": { \"type\": \"string\" },\n                    \"description\": { \"type\": \"string\" },\n                    \"question\": { \"type\": \"string\" }\n                  },\n                  \"required\": [\"value\", \"description\", \"question\"]\n                },\n                \"competitors_urls\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                    \"value\": { \"type\": \"string\" },\n                    \"description\": { \"type\": \"string\" },\n                    \"question\": { \"type\": \"string\" }\n                  },\n                  \"required\": [\"value\", \"description\", \"question\"]\n                },\n                \"marketing_budget\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                    \"value\": { \"type\": \"string\" },\n                    \"description\": { \"type\": \"string\" },\n                    \"question\": { \"type\": \"string\" }\n                  },\n                  \"required\": [\"value\", \"description\", \"question\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        416,
        800
      ],
      "id": "2b84a8db-779a-4d69-b936-d79cd14fd7d7",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "87dfca32-2345-4ca3-90d5-e2ad59166aa3",
                    "leftValue": "={{ $json.events.findLast(item => item.event_type !== \"TG_CHAT_MESSAGE_RECEIVED\")?.event_type === \"TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_COMPLETED\" }}\n",
                    "rightValue": "true",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–û–ø—Ä–æ—Å–Ω–∏–∫ –ø—Ä–æ–π–¥–µ–Ω"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f06cd145-9333-4e08-bd71-e1397a032967",
                    "leftValue": "={{ $json.events.filter(item => item.event_type === \"FUNNEL_SELECTED\").length > 0 }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–í–æ—Ä–æ–Ω–∫–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.events.findLast(item => item.event_type !== \"TG_CHAT_MESSAGE_RECEIVED\")?.event_type === \"TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_REQUESTED\" }}\n",
                    "rightValue": "=true",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "8132c160-19ce-4e2e-a0b4-0389db893d1f"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å–Ω–∏–∫"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -288,
        32
      ],
      "id": "32785656-3c18-4400-9c15-88dda390ab87",
      "name": "Survey switch"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json) }}\n\n1) —Å–∫–ª–µ–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ \n\nevent_type = TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED - –ø–µ—Ä–≤–∏—á–Ω–æ–π —Ñ–æ—Ä–º—ã –æ–ø—Ä–æ—Å–∞ –∏ event_type=\"TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_COMPLETED\" - —É–∂–µ —É—Ç–æ—á–Ω–µ–Ω–Ω—ã—Ö –∏ –æ—Ç–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–æ–Ω–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ)\n\n2) –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏—è –æ –≤–æ—Ä–æ–Ω–∫–∞—Ö (tool–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏—è –æ –≤–æ—Ä–æ–Ω–∫–∞—Ö –ø—Ä–æ–¥–∞–∂) –ø—Ä–æ–¥–∞–∂ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å–∞–º—ã–π –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç\n\n3) –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ –∏ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –∫–∞—Å–∞–µ–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞ (–∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å–∞–Ω –≤ –¥–∞–Ω–Ω—ã—Ö) —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –∫–∞–∫ —ç—Ç–∞ –≤–æ—Ä–æ–Ω–∫–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –ø–æ—á–µ–º—É –æ–Ω–∞ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥–æ—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç—É –∏ –µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç—É\n\n–ò—Ç–æ–≥–æ–≤—ã–π output –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–ª—å—à–µ 4000 —Å–∏–º–≤–æ–ª–æ–≤\n\nOutput –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –±–æ—Ç–∞ –∏–ª–∏ —Ç–≤–æ–π –ø—Ä–æ–º–ø—Ç –∏–ª–∏ –µ–≥–æ —á–∞—Å—Ç—å (–Ω–µ –Ω–∞–¥–æ –ø–∏—Å–∞—Ç—å –ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –≤–∞–º –æ—Ç–≤–µ—Ç)\n",
        "options": {
          "systemMessage": "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç-–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫ –ø–æ –≤–æ—Ä–æ–Ω–∫–∞–º –ø—Ä–æ–¥–∞–∂. "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        2320,
        368
      ],
      "id": "78a366ad-6742-4a96-9bed-829698e02567",
      "name": "–ü–æ–¥–±–æ—Ä –≤–æ—Ä–æ–Ω–∫–∏"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2592,
        800
      ],
      "id": "c3307e6a-674b-48c5-8160-a9084367a674",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "mrmnOe1SW7Qiuamb",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.event.payload.funnel_description }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3104,
        368
      ],
      "id": "44cf9b92-6b65-4244-b855-7cd3311c7b3d",
      "name": "Send a text message",
      "webhookId": "d933082f-e070-416c-961a-53914f6a27b8",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "59a41b33-4967-4649-8ff7-a79fb58b098d",
              "leftValue": "={{ $json.output.result.is_survey_passed }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        784,
        576
      ],
      "id": "deba5f97-02df-4429-b12b-a3c76a0043aa",
      "name": "If survey ready"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ \n\n$json.events.findLastIndex(item => item.event_type === 'TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED') > \n$json. events.findLastIndex(item => item.event_type === 'TG_CHAT_FUNNELS_BRIEF_FORM_REQUESTED') \n}}",
                    "rightValue": "TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "8132c160-19ce-4e2e-a0b4-0389db893d1f"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ë—Ä–∏—Ñ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -512,
        208
      ],
      "id": "17c02ce0-c91a-4380-8d53-d9ba8d2b8604",
      "name": "brief switch"
    },
    {
      "parameters": {
        "chatId": "={{ $('TG_CHAT_MESSAGE_RECEIVED').item.json.events[0].payload.messages[0].chat.id }}",
        "text": "–Ø –≤—Å–µ –ø–æ–Ω—è–ª, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–æ—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω. –ü–æ–¥–±–∏—Ä–∞—é –≤–∞–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –≤–æ—Ä–æ–Ω–∫—É!",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1584,
        432
      ],
      "id": "f8072685-0429-4c27-a08b-645631b29d8b",
      "name": "Survey ok message",
      "webhookId": "d933082f-e070-416c-961a-53914f6a27b8",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('EXTRACT briefs and surveys').item.json.chat_id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1360,
        736
      ],
      "id": "d39f7def-e209-4608-b226-8c7a9ae0bd50",
      "name": "–ó–∞–ø—Ä–æ—Å survey",
      "webhookId": "e1f4b001-b7a3-47d0-bf09-830188d88be3",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–¢–´ –ü–û–õ–£–ß–ê–ï–®–¨ –ò–í–ï–ù–¢–´ –ß–ê–¢–ê\nevent_type: TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED - –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ –∑–∞–ø–æ–ª–Ω–∏–ª —Ñ–æ—Ä–º—É —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏\n–≤ payload —ç—Ç–æ–≥–æ –∏–≤–µ–Ω—Ç–∞ —Ç—ã –Ω–∞–π–¥–µ—à—å –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã\n\nTG_CHAT_FUNNELS_ADDITIONAL_SURVEY_REQUESTED - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –æ–ø—Ä–æ—Å –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª –Ω–∞ –ø—Ä–æ—à–ª–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏. –¢–∞–º –µ—Å—Ç—å questions_to_ask - –≤–æ–ø—Ä–æ—Å—ã –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã —Ç–æ–≥–¥–∞ —Ä–µ—à–∏–ª –¥–æ–∑–∞–¥–∞—Ç—å, result - —Ç–µ–∫—É—â–∏–π —Å—Ç–µ–π—Ç –æ–ø—Ä–æ—Å–Ω–∏–∫–∞. –ï—Å–ª–∏ result.is_survey_passed - –æ–ø—Ä–æ—Å–Ω–∏–∫ –ø—Ä–æ–π–¥–µ–Ω. –ï—Å–ª–∏ –Ω–µ—Ç - —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è. –ï—Å–ª–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∞–Ω–∞–ª–∏–∑–∞ –∏–≤–µ–Ω—Ç–æ–≤ –ø—Ä–∏—à–µ–¥—à–∏—Ö —Ç–µ–±–µ –Ω–∞ –≤—Ö–æ–¥ —Ç—ã —Å—á–∏—Ç–∞–µ—à—å, —á—Ç–æ –æ–ø—Ä–æ—Å–Ω–∏–∫ –ø—Ä–æ–π–¥–µ–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ, —Å–¥–µ–ª–∞–π result.is_survey_passed \n =true –∫–æ–≥–¥–∞ –±—É–¥–µ—à—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n–æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞ —Å–∫–ª–∞–¥—ã–≤–∞–π –≤ result.answers –ø–æ json —Å—Ö–µ–º–µ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤ output parser\n\n–ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∏–≤–µ–Ω—Ç—ã:\n{{ JSON.stringify($json.brief_and_survey_events) }}\n\n–û—Ç–≤–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –æ–ø—Ä–æ—Å–∞:\n{{ $json.current_suvrey_answer }}\n\n–¢–µ–±–µ –Ω—É–∂–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—è —Å —Ç–µ–∫—É—â–∏–º –æ—Ç–≤–µ—Ç–æ–º –∏ –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ø–æ–ª—é, —Ç–æ –ø–æ –Ω–µ–º—É –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã.\n\n–Ω–µ –∑–∞–≤–µ—Ä—à–∞–π –æ–ø—Ä–æ—Å–Ω–∏–∫ –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—à—å —É–≤–µ—Ä–µ–Ω —á—Ç–æ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Ç–µ–º –≤–æ–ø—Ä–æ—Å–∞–º/–ø–æ–ª—è–º –∫ –∫–æ—Ç–æ—Ä—ã–º –æ–Ω–∏ –ø—Ä–∏–ª–∏–Ω–∫–æ–≤–∞–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ json\n\n–ï—Å–ª–∏ –æ–ø—Ä–æ—Å–Ω–∏–∫ –Ω–µ —É—Å—Ç—Ä–æ–∏–ª, –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π –≤ questions_to_ask \n1) —á—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ—Ç–≤–µ—Ç–∞—Ö\n2) –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –¥–æ–æ—Ç–≤–µ—Ç–∏—Ç—å\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç-–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫ –ø–æ –≤–æ—Ä–æ–Ω–∫–∞–º –ø—Ä–æ–¥–∞–∂. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∏—Ñ, –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —á—Ç–æ–±—ã –≤—ã—è–≤–∏—Ç—å —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞, –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏. –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç—ã –¥–æ–ª–∂–µ–Ω —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤. –¢–≤–æ—è –∫–æ–Ω–µ—á–Ω–∞—è —Ü–µ–ª—å ‚Äî —Å–æ–±—Ä–∞—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –≤–æ—Ä–æ–Ω–∫–∏ –ø—Ä–æ–¥–∞–∂.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        224,
        576
      ],
      "id": "ffd54c3b-6425-4f17-bec0-d896cb94a203",
      "name": "Brief clarification",
      "retryOnFail": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO public.session_state (chat_id, events)\nVALUES (\n    {{ $('TG_CHAT_MESSAGE_RECEIVED').item.json.events[0].payload.messages[0].chat.id }},\n    -- –°–æ–∑–¥–∞–µ–º –≤—Å—é JSON-—Å—Ç—Ä–æ–∫—É –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è n8n\n    $json_payload$\n    {{\n      JSON.stringify($json)\n    }}\n    $json_payload$::jsonb\n)\nON CONFLICT (chat_id) DO UPDATE\nSET\n    events = session_state.events || EXCLUDED.events,\n    updated_at = CURRENT_TIMESTAMP;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1360,
        432
      ],
      "id": "e659fc80-db9d-45ae-b4f3-c3d95e81b342",
      "name": "TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_COMPLETED",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO public.session_state (chat_id, events)\nVALUES (\n    {{ $json.result.chat.id }},\n  ('[ { \"event_type\": \"TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_REQUESTED\", \"payload\": { \"survey_state\":' || '{{ JSON.stringify($('Brief clarification').item.json.output)  }}' || ' } } ]')::jsonb\n)\nON CONFLICT (chat_id) DO UPDATE\nSET events = session_state.events || EXCLUDED.events,\n    updated_at = CURRENT_TIMESTAMP\n;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1584,
        736
      ],
      "id": "4db96be4-3420-48bf-bd51-01643d066395",
      "name": "TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_REQUESTED",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e31dbd81-ba1c-4826-ae08-735c76d25d1b",
              "name": "niche.value",
              "value": "={{ $json['–í –∫–∞–∫–æ–π –Ω–∏—à–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç?'] }}",
              "type": "string"
            },
            {
              "id": "new-niche-desc",
              "name": "niche.description",
              "value": "–í –∫–∞–∫–æ–π –Ω–∏—à–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç?",
              "type": "string"
            },
            {
              "id": "c7eb103d-8ec6-4b4c-8914-95ced7907ad4",
              "name": "product.value",
              "value": "={{ $json['–ö–∞–∫–æ–π —É –≤–∞—Å –ø—Ä–æ–¥—É–∫—Ç?'] }}",
              "type": "string"
            },
            {
              "id": "new-product-desc",
              "name": "product.description",
              "value": "–ö–∞–∫–æ–π —É –≤–∞—Å –ø—Ä–æ–¥—É–∫—Ç?",
              "type": "string"
            },
            {
              "id": "0c2a5f05-4ded-4957-b139-266b46404e7b",
              "name": "cost.value",
              "value": "={{ $json['–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞'] }}",
              "type": "string"
            },
            {
              "id": "new-cost-desc",
              "name": "cost.description",
              "value": "–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞",
              "type": "string"
            },
            {
              "id": "0c646abd-f1e9-48a5-b19d-38c47528a958",
              "name": "audience.value",
              "value": "={{ $json['–û–ø–∏—à–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é'] }}",
              "type": "string"
            },
            {
              "id": "new-audience-desc",
              "name": "audience.description",
              "value": "–û–ø–∏—à–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é",
              "type": "string"
            },
            {
              "id": "ebb85a38-7ea0-48f2-a629-f7c060d7d542",
              "name": "competitors_urls.value",
              "value": "={{ $json['–°–∫–∏–Ω—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤'] }}",
              "type": "string"
            },
            {
              "id": "new-competitors-desc",
              "name": "competitors_urls.description",
              "value": "–°–∫–∏–Ω—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤",
              "type": "string"
            },
            {
              "id": "b9be6640-73c6-4fe3-b7b8-e0fb35c5712d",
              "name": "funnel_okr.value",
              "value": "={{ $json['–ö–∞–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –≤–æ—Ä–æ–Ω–∫–∏ –¥–ª—è –≤–∞—Å –±—É–¥—É—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã?'] }}",
              "type": "array"
            },
            {
              "id": "new-funnel-desc",
              "name": "funnel_okr.description",
              "value": "–ö–∞–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –≤–æ—Ä–æ–Ω–∫–∏ –¥–ª—è –≤–∞—Å –±—É–¥—É—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã?",
              "type": "string"
            },
            {
              "id": "4b4c96cb-adf2-4f2d-8d8b-a758d7d5a4c1",
              "name": "marketing_budget.value",
              "value": "={{ $json['–ö–∞–∫–æ–π —É –≤–∞—Å –±—é–¥–∂–µ—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É?'] }}",
              "type": "string"
            },
            {
              "id": "new-budget-desc",
              "name": "marketing_budget.description",
              "value": "–ö–∞–∫–æ–π —É –≤–∞—Å –±—é–¥–∂–µ—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É?",
              "type": "string"
            },
            {
              "id": "468ede98-878e-4b01-966c-504de88c9887",
              "name": "target_channels.value",
              "value": "={{ $json['–í –∫–∞–∫–∏—Ö –∫–∞–Ω–∞–ª–∞—Ö –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ç—Ä–∞—Ñ–∏–∫?'] }}",
              "type": "string"
            },
            {
              "id": "new-channels-desc",
              "name": "target_channels.description",
              "value": "–í –∫–∞–∫–∏—Ö –∫–∞–Ω–∞–ª–∞—Ö –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ç—Ä–∞—Ñ–∏–∫?",
              "type": "string"
            },
            {
              "id": "3bb2f979-1292-4880-bb3e-1ca405826030",
              "name": "tested_funnels.value",
              "value": "={{ $json['–ö–∞–∫–∏–µ –≤–æ—Ä–æ–Ω–∫–∏ —É–∂–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏?'] }}",
              "type": "string"
            },
            {
              "id": "new-tested-desc",
              "name": "tested_funnels.description",
              "value": "–ö–∞–∫–∏–µ –≤–æ—Ä–æ–Ω–∫–∏ —É–∂–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏?",
              "type": "string"
            },
            {
              "id": "d3d1bfcb-7b04-4c49-8a94-4b98ab166e96",
              "name": "webinar_experience.value",
              "value": "={{ $json['–ë—ã–ª –ª–∏ –æ–ø—ã—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–≤–µ–±–∏–Ω–∞—Ä–æ–≤?'] }}",
              "type": "string"
            },
            {
              "id": "new-webinar-desc",
              "name": "webinar_experience.description",
              "value": "–ë—ã–ª –ª–∏ –æ–ø—ã—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–≤–µ–±–∏–Ω–∞—Ä–æ–≤?",
              "type": "string"
            },
            {
              "id": "fb4c7fd4-7ec7-483a-a059-8d6164635899",
              "name": "comments.value",
              "value": "={{ $json['–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏'] }}",
              "type": "string"
            },
            {
              "id": "new-comments-desc",
              "name": "comments.description",
              "value": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏",
              "type": "string"
            },
            {
              "id": "1e69e843-9348-4c63-ad81-d576c959a96c",
              "name": "submitted_at.value",
              "value": "={{ $json.submittedAt }}",
              "type": "string"
            },
            {
              "id": "new-submitted-desc",
              "name": "submitted_at.description",
              "value": "submittedAt",
              "type": "string"
            },
            {
              "id": "a98179c5-dc7a-4c44-b313-c7f2a7b30554",
              "name": "chat_id",
              "value": "={{ $json.chat_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -736,
        656
      ],
      "id": "2c029198-6270-420d-867f-02defe3a7fdf",
      "name": "Answers to json keys"
    },
    {
      "parameters": {
        "jsCode": "let events = $input.all()[0].json.events\n\n// 1. –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω—É–∂–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.\n// –ú–µ—Ç–æ–¥ findLastIndex –∏—â–µ—Ç —Å –∫–æ–Ω—Ü–∞ –º–∞—Å—Å–∏–≤–∞, —á—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.\nconst lastBriefFormIndex = events.findLastIndex(item => item.event_type === 'TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED');\n\nvar finalArray = []\n\n// –ï—Å–ª–∏ —Ç–∞–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤\nif (lastBriefFormIndex !== -1) {\n  finalArray.push(events[lastBriefFormIndex])\n}\n\nconst lastSurveyRequestedIdx = events.findLastIndex(item => item.event_type === 'TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_REQUESTED');\n\nif (lastSurveyRequestedIdx !== -1) {\n  finalArray.push(events[lastSurveyRequestedIdx])\n}\n\n\nlet lastEvent = events.findLast(item => true);\nlet curAns = lastEvent.event_type === \"TG_CHAT_MESSAGE_RECEIVED\" ? lastEvent.payload.messages[0].text : \"–µ—â–µ –ø–æ–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–≤–µ—Ç–∞, —Ç.–∫. –Ω–µ—Ç –æ–ø—Ä–æ—Å–Ω–∏–∫–∞\";\nreturn {\n  \"brief_and_survey_events\": finalArray,\n  \"current_suvrey_answer\": curAns,\n  \"chat_id\": $input.all()[0].json.chat_id\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -64,
        336
      ],
      "id": "8e3046d3-9ba4-4055-9f06-fee16bcb9790",
      "name": "EXTRACT briefs and surveys"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "BEGIN;\nINSERT INTO public.session_state (chat_id, events)\nVALUES (\n  {{ $json.message.chat.id }},\n  ('[ { \"event_type\": \"TG_CHAT_MESSAGE_RECEIVED\", \"payload\": { \"messages\": [ ' || '{{ JSON.stringify($json.message) }}' || ' ] } } ]')::jsonb\n)\nON CONFLICT (chat_id) DO UPDATE\nSET events = session_state.events || EXCLUDED.events,\n    updated_at = CURRENT_TIMESTAMP;\n\nSELECT events, chat_id FROM public.session_state WHERE chat_id = {{ $json.message.chat.id }};\n\nCOMMIT;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -736,
        208
      ],
      "id": "2727798d-f870-40bf-a669-a40e00c6d66d",
      "name": "TG_CHAT_MESSAGE_RECEIVED",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text === \"/reset\" }}",
                    "rightValue": "TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "8132c160-19ce-4e2e-a0b4-0389db893d1f"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reset chat"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -960,
        112
      ],
      "id": "7b75931e-c476-4abe-a18c-6606f7c9f385",
      "name": "Command Switch"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "BEGIN;\n  DELETE FROM public.session_state\n  WHERE session_state.chat_id = {{ $json.message.chat.id }};\n\nSELECT {{ $json.message.chat.id }} as chat_id;\nCOMMIT;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -736,
        16
      ],
      "id": "562c697b-5340-460f-88f3-02b8920dd91c",
      "name": "RESET CHAT",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "formTitle": "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–∞—Ö –≤–æ—Ä–æ–Ω–æ–∫",
        "formFields": {
          "values": [
            {
              "fieldLabel": "funnel_types",
              "fieldType": "file",
              "acceptFileTypes": "json",
              "requiredField": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        -1184,
        1168
      ],
      "id": "003c074a-dddc-4d3e-bd9c-05af4b19b6ba",
      "name": "On form submission2",
      "webhookId": "8a37fe43-d780-4074-99cd-60e69b244bb7"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –≤–∞—à –æ–±—ä–µ–∫—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –æ–ø—Ä–æ—Å–∞\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–∞–∫ JavaScript –æ–±—ä–µ–∫—Ç\n\n// –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤–µ—Å—å –æ–±—ä–µ–∫—Ç –≤ JSON-—Å—Ç—Ä–æ–∫—É\nreturn {\n    \"event_type\": \"TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_COMPLETED\",\n    \"payload\": {\n        \"survey_state\": $input.item.json.output\n    }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        432
      ],
      "id": "76c29068-e613-456d-95c1-a28c763c23dc",
      "name": "Build survey state"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n    event\nFROM (\n    SELECT\n        jsonb_array_elements(events) AS event\n    FROM\n        public.session_state\n    WHERE\n        chat_id = {{ $('brief switch').item.json.chat_id }}\n) AS all_events\nWHERE\n    all_events.event->>'event_type' = 'TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED'\n    OR all_events.event->>'event_type' = 'TG_CHAT_ADDITIONAL_SURVEY_COMPLETED';",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1808,
        32
      ],
      "id": "5ee0ec25-f911-4bd2-9476-0ad66f778161",
      "name": "GET BRIEF EVENTS",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "event",
              "renameField": true,
              "outputFieldName": "event"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2032,
        128
      ],
      "id": "062b2e44-2eaa-41ba-bf43-99b4bbbc5040",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Survey ok message').item.json.result.from.id }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        2384,
        592
      ],
      "id": "eeabd23a-f621-4aae-8c4f-0c9ea371b874",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "0lNa5njGWb8wLXvC",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.chat_id }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        288,
        800
      ],
      "id": "3d62c3c6-5d0d-4d12-9e82-e5f890940224",
      "name": "Postgres Chat Memory1",
      "credentials": {
        "postgres": {
          "id": "0lNa5njGWb8wLXvC",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "formTitle": "–ë—Ä–∏—Ñ",
        "formDescription": "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É, —á—Ç–æ–±—ã –ò–ò –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª, –∫–∞–∫–∞—è –≤–æ—Ä–æ–Ω–∫–∞ –±—É–¥–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–∞–º –¥–µ–Ω—å–≥–∏ ",
        "formFields": {
          "values": [
            {
              "fieldLabel": "–í –∫–∞–∫–æ–π –Ω–∏—à–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç?",
              "requiredField": true
            },
            {
              "fieldLabel": "–ö–∞–∫–æ–π —É –≤–∞—Å –ø—Ä–æ–¥—É–∫—Ç?",
              "requiredField": true
            },
            {
              "fieldLabel": "–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞",
              "requiredField": true
            },
            {
              "fieldLabel": "–û–ø–∏—à–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é",
              "requiredField": true
            },
            {
              "fieldLabel": "–°–∫–∏–Ω—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤",
              "requiredField": true
            },
            {
              "fieldLabel": "–ö–∞–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –≤–æ—Ä–æ–Ω–∫–∏ –¥–ª—è –≤–∞—Å –±—É–¥—É—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã?",
              "fieldType": "checkbox",
              "fieldOptions": {
                "values": [
                  {
                    "option": "ROAS –Ω–µ –º–µ–Ω–µ–µ 100%"
                  },
                  {
                    "option": "ROAS –±–æ–ª–µ–µ 100%"
                  },
                  {
                    "option": "ROAS –Ω–µ –º–µ–Ω–µ–µ 200%"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "–ö–∞–∫–æ–π —É –≤–∞—Å –±—é–¥–∂–µ—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É?"
            },
            {
              "fieldLabel": "–í –∫–∞–∫–∏—Ö –∫–∞–Ω–∞–ª–∞—Ö –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ç—Ä–∞—Ñ–∏–∫?",
              "requiredField": true
            },
            {
              "fieldLabel": "–ö–∞–∫–∏–µ –≤–æ—Ä–æ–Ω–∫–∏ —É–∂–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏?",
              "requiredField": true
            },
            {
              "fieldLabel": "–ë—ã–ª –ª–∏ –æ–ø—ã—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–≤–µ–±–∏–Ω–∞—Ä–æ–≤?",
              "requiredField": true
            },
            {
              "fieldLabel": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏"
            },
            {
              "fieldName": "chat_id",
              "fieldType": "hiddenField",
              "fieldValue": "={{ $query.chat_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        -1184,
        656
      ],
      "id": "3d760c22-9ec0-4b03-b59b-b3505ed14060",
      "name": "Brief Form",
      "webhookId": "5f8eaf12-5bd2-4bae-b794-8aaf52ddd3f6"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "BEGIN;\n\n  INSERT INTO public.session_state (chat_id, events)\nVALUES (\n    {{ $('TG_CHAT_MESSAGE_RECEIVED').item.json.events[0].payload.messages[0].chat.id }},\n  ('[ { \"event_type\": \"FUNNEL_SELECTED\", \"payload\": { \"funnel_description\":' || '{{ JSON.stringify($json.output)  }}' || ' } } ]')::jsonb\n)\nON CONFLICT (chat_id) DO UPDATE\nSET events = session_state.events || EXCLUDED.events,\n    updated_at = CURRENT_TIMESTAMP;\n\nSELECT\n    events->-1 AS event, -- –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞\n    chat_id\nFROM\n    public.session_state\nWHERE\n    chat_id = {{ $('TG_CHAT_MESSAGE_RECEIVED').item.json.events[0].payload.messages[0].chat.id }}\n    AND events->-1->>'event_type' = 'FUNNEL_SELECTED'; -- –ü—Ä–æ–≤–µ—Ä—è–µ–º 'event_type' —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞\n\n  \nCOMMIT;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2880,
        368
      ],
      "id": "52afeb91-9d9a-42da-9de1-11afbd34360b",
      "name": "FUNNEL_SELECTED",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n    event\nFROM (\n    SELECT\n        jsonb_array_elements(events) AS event\n    FROM\n        public.session_state\n    WHERE\n        chat_id = {{ $json.result.chat.id }}\n) AS all_events\nWHERE\n    all_events.event->>'event_type' = 'TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED'\n    OR all_events.event->>'event_type' = 'TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_COMPLETED';",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1808,
        432
      ],
      "id": "ab33ef46-69d4-42b8-95f0-311dbed5696a",
      "name": "GET BRIEF EVENTS1",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "H7wrBOGXpuFXc64X",
          "name": "funnels_state_db"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        160,
        800
      ],
      "id": "33f264e5-32a9-43a4-931d-d52289b449be",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "mrmnOe1SW7Qiuamb",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2256,
        592
      ],
      "id": "8b6d70c2-1c8f-49df-89ed-eea4fb2ac0d9",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "mrmnOe1SW7Qiuamb",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1088,
        960
      ],
      "id": "4fc53639-46a1-46b5-84ca-206eddee5a3a",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "mrmnOe1SW7Qiuamb",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('brief switch').item.json.chat_id }}",
        "text": "=–í–æ—Ä–æ–Ω–∫–∞ –¥–ª—è –≤–∞—Å —É–∂–µ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞!\n\n{{ $json.events.filter(item => item.event_type === \"FUNNEL_SELECTED\").last().payload.funnel_description}}\n\n–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞, –≤–≤–µ–¥–∏—Ç–µ /reset\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -64,
        -112
      ],
      "id": "de7500e5-f866-4035-811f-5b568318d528",
      "name": "Send a text message1",
      "webhookId": "32f82c68-69cd-4c8c-afc4-081c3091736c",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -512,
        16
      ],
      "id": "153236ca-48fe-4c77-a851-0da15c0551b0",
      "name": "Send a text message2",
      "webhookId": "9e546409-5b0f-47ab-9479-2478fe9ae06f",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –≤–∞—à –æ–±—ä–µ–∫—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –æ–ø—Ä–æ—Å–∞\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–∞–∫ JavaScript –æ–±—ä–µ–∫—Ç\n\n// –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤–µ—Å—å –æ–±—ä–µ–∫—Ç –≤ JSON-—Å—Ç—Ä–æ–∫—É\nreturn {\n    \"chat_id\":  $json.chat_id,\n    \"event_type\": \"TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED\",\n    \"payload\": {\n        \"brief_content\": $json\n    }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -512,
        656
      ],
      "id": "5be1bbaf-931f-4983-9c7d-b320d3101f4b",
      "name": "Build TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–í–æ–ø—Ä–æ—Å—ã –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –∑–∞–¥–∞—Ç—å –±–µ—Ä–∏  –≤–æ—Ç –æ—Ç—Å—é–¥–∞\n{{ JSON.stringify($json.output.questions_to_ask) }}\n\n",
        "options": {
          "systemMessage": "–¢–´ –ì–û–í–û–†–ò–®–¨ –¢–û–õ–¨–ö–û –ü–û –†–£–°–°–ö–ò\n\n—Ç—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ –∫–æ–Ω—Ç–æ—Ä–µ –ø–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É \n\n—Ç–µ–±–µ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –æ–ø—Ä–æ—Å–Ω–∏–∫—É\n–ø–µ—Ä–µ–≤–µ–¥–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1008,
        736
      ],
      "id": "3302c0e4-e7d6-47dd-8511-83146e5ffcd0",
      "name": "JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç –û–ø—Ä–æ—Å–Ω–∏–∫–∞ –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ, —è –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–∞–Ω–Ω—ã–µ –ø–æ –≤–∞—à–µ–º—É –ë–ò–ó–ù–ï–°–£",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        368,
        176
      ],
      "id": "9d931832-e168-4769-922e-f6945621eb9c",
      "name": "Notify Thinking of business",
      "webhookId": "22f2ddaa-297d-4aef-9662-aef627d25672",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.event[0].chat_id }}",
        "text": "=–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ, —è –≤—ã–±–∏—Ä–∞—é –≤–∞–º –≤–æ—Ä–æ–Ω–∫—É –ø—Ä–æ–¥–∞–∂.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2464,
        -48
      ],
      "id": "cad62cb8-3365-4717-871f-b5307cfb363d",
      "name": "Thinking of funnel",
      "webhookId": "bfb1d0d3-f5fa-4062-9a63-ee66bd545bad",
      "credentials": {
        "telegramApi": {
          "id": "gZTs7CzMRiGtPDQZ",
          "name": "Yarik Bot"
        }
      }
    }
  ],
  "connections": {
    "Postgres PGVector Store": {
      "ai_tool": [
        [
          {
            "node": "–ü–æ–¥–±–æ—Ä –≤–æ—Ä–æ–Ω–∫–∏",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Postgres PGVector Store1",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Postgres PGVector Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Form": {
      "main": [
        [
          {
            "node": "Answers to json keys",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send_brief_form_link": {
      "main": [
        [
          {
            "node": "TG_CHAT_FUNNELS_BRIEF_FORM_REQUESTED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG_MESSAGE_RECEIVED": {
      "main": [
        [
          {
            "node": "Command Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED": {
      "main": [
        [
          {
            "node": "EXTRACT briefs and surveys",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Brief clarification",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Survey switch": {
      "main": [
        [
          {
            "node": "GET BRIEF EVENTS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "EXTRACT briefs and surveys",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "EXTRACT briefs and surveys",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–±–æ—Ä –≤–æ—Ä–æ–Ω–∫–∏": {
      "main": [
        [
          {
            "node": "FUNNEL_SELECTED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "If survey ready": {
      "main": [
        [
          {
            "node": "Build survey state",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç –û–ø—Ä–æ—Å–Ω–∏–∫–∞ –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "brief switch": {
      "main": [
        [
          {
            "node": "Survey switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "send_brief_form_link",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Survey ok message": {
      "main": [
        [
          {
            "node": "GET BRIEF EVENTS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø—Ä–æ—Å survey": {
      "main": [
        [
          {
            "node": "TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_REQUESTED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Brief clarification": {
      "main": [
        [
          {
            "node": "If survey ready",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_COMPLETED": {
      "main": [
        [
          {
            "node": "Survey ok message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Answers to json keys": {
      "main": [
        [
          {
            "node": "Build TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EXTRACT briefs and surveys": {
      "main": [
        [
          {
            "node": "Notify Thinking of business",
            "type": "main",
            "index": 0
          },
          {
            "node": "Brief clarification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG_CHAT_MESSAGE_RECEIVED": {
      "main": [
        [
          {
            "node": "brief switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Command Switch": {
      "main": [
        [
          {
            "node": "RESET CHAT",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TG_CHAT_MESSAGE_RECEIVED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RESET CHAT": {
      "main": [
        [
          {
            "node": "Send a text message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "On form submission2": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build survey state": {
      "main": [
        [
          {
            "node": "TG_CHAT_FUNNELS_ADDITIONAL_SURVEY_COMPLETED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GET BRIEF EVENTS": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Thinking of funnel",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü–æ–¥–±–æ—Ä –≤–æ—Ä–æ–Ω–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "–ü–æ–¥–±–æ—Ä –≤–æ—Ä–æ–Ω–∫–∏",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Brief clarification",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Brief Form": {
      "main": [
        [
          {
            "node": "Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FUNNEL_SELECTED": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GET BRIEF EVENTS1": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Brief clarification",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "–ü–æ–¥–±–æ—Ä –≤–æ—Ä–æ–Ω–∫–∏",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç –û–ø—Ä–æ—Å–Ω–∏–∫–∞ –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Build TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED": {
      "main": [
        [
          {
            "node": "TG_CHAT_FUNNELS_BRIEF_FORM_COMPLETED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç –û–ø—Ä–æ—Å–Ω–∏–∫–∞ –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã": {
      "main": [
        [
          {
            "node": "–ó–∞–ø—Ä–æ—Å survey",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notify Thinking of business": {
      "main": [
        []
      ]
    }
  },
  "pinData": {
    "TG_MESSAGE_RECEIVED": [
      {
        "update_id": 237444611,
        "message": {
          "message_id": 206,
          "from": {
            "id": 212935169,
            "is_bot": false,
            "first_name": "Iaroslav",
            "username": "verse537",
            "language_code": "ru",
            "is_premium": true
          },
          "chat": {
            "id": 212935169,
            "first_name": "Iaroslav",
            "username": "verse537",
            "type": "private"
          },
          "date": 1758212408,
          "text": "–ö–æ–Ω–µ—á–Ω–æ, –≤–æ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –±—Ä–∏—Ñ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Å—Ñ–µ—Ä–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏–≥—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—à–∏–º –∏–Ω—Ç–µ—Ä–µ—Å–∞–º.\n\n***\n\n–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –≤–æ–ø—Ä–æ—Å—ã. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.\n\n1.  –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞: –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –ø–æ –º–æ–¥–µ–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏ (SaaS). –£ –Ω–∞—Å —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–∞:\n    *   Indie: $49/–º–µ—Å—è—Ü. –í–∫–ª—é—á–∞–µ—Ç 1 –ø—Ä–æ–µ–∫—Ç, –¥–æ 10,000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –º–µ—Å—è—Ü (MAU), –±–∞–∑–æ–≤—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—Ç—á–µ—Ç—ã –ø–æ —Å–±–æ—è–º.\n    *   Studio: $249/–º–µ—Å—è—Ü. –í–∫–ª—é—á–∞–µ—Ç –¥–æ 5 –ø—Ä–æ–µ–∫—Ç–æ–≤, –¥–æ 100,000 MAU, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Jira –∏ Slack, –∞–Ω–∞–ª–∏–∑ –∞—Å—Å–µ—Ç–æ–≤.\n    *   Enterprise: –æ—Ç $999/–º–µ—Å—è—Ü (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç). –í–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ MAU, –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø –∫ API.\n\n2.  –ù–∏—à–∞ –ø—Ä–æ–µ–∫—Ç–∞: –ù–∞—à–∞ –Ω–∏—à–∞ ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–±–∏–ª—å–Ω—ã—Ö –∏–≥—Ä –Ω–∞ –¥–≤–∏–∂–∫–µ Unity. –ú—ã –ø–æ–º–æ–≥–∞–µ–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –≤—ã—è–≤–ª—è—Ç—å –∏ —É—Å—Ç—Ä–∞–Ω—è—Ç—å \"—É–∑–∫–∏–µ –º–µ—Å—Ç–∞\" –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Å–Ω–∏–∂–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–±–æ–µ–≤ –∏ —É–º–µ–Ω—å—à–∞—Ç—å —Ä–∞–∑–º–µ—Ä –±–∏–ª–¥–∞ –∏–≥—Ä—ã, —á—Ç–æ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–æ—Ö–æ–¥.\n\n3.  –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞: –ù–∞—à –ø—Ä–æ–¥—É–∫—Ç ‚Äî —ç—Ç–æ SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ \"PerfOptimizator\". –û–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –∏–≥—Ä–æ–≤–æ–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ Unity —á–µ—Ä–µ–∑ –ª–µ–≥–∫–∏–π SDK. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (FPS, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏, –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU/GPU) —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.\n    *   –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:\n        *   Real-time Performance Monitoring: –î–∞—à–±–æ—Ä–¥—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–∑—Ä–µ–∑–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –≤–µ—Ä—Å–∏–π –û–° –∏ –±–∏–ª–¥–æ–≤.\n        *   Crash Reporting: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ –æ —Å–±–æ—è—Ö —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–∞–º–∏.\n        *   Asset Analysis: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞—Å—Å–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∂–∞—Ç–∏–µ —Ç–µ–∫—Å—Ç—É—Ä, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π).\n        *   Build Size Tracker: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –±–∏–ª–¥–∞ –∏ –µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –µ–≥–æ —Ä–æ—Å—Ç–æ–º.\n\n4.  –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è (–¶–ê):\n    *   –ü–µ—Ä–≤–∏—á–Ω–∞—è –¶–ê: –ò–Ω–¥–∏-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –Ω–µ–±–æ–ª—å—à–∏–µ —Å—Ç—É–¥–∏–∏ (2-15 —á–µ–ª–æ–≤–µ–∫), –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞—é—Ç –º–æ–±–∏–ª—å–Ω—ã–µ –∏–≥—Ä—ã –Ω–∞ Unity. –£ –Ω–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ —à–∏—Ä–æ–∫–æ–º –ø–∞—Ä–∫–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤.\n    *   –í—Ç–æ—Ä–∏—á–Ω–∞—è –¶–ê: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–∏–¥—ã (Technical Leads) –∏ –∏–Ω–∂–µ–Ω–µ—Ä—ã –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Performance Engineers) –≤ —Å—Ä–µ–¥–Ω–∏—Ö –∏ –∫—Ä—É–ø–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö —Å—Ç—É–¥–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∏—â—É—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.\n\n5.  –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã:\n    *   Unity Performance Monitoring (UPM): –ü—Ä—è–º–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç –æ—Ç —Å–∞–º–æ–≥–æ Unity. –ù–∞—à–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ –±–æ–ª–µ–µ –≥–∏–±–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã –¥–ª—è –∏–Ω–¥–∏. –°—Å—ã–ª–∫–∞: https://unity.com/solutions/performance-reporting\n    *   GameAnalytics: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –±–∞–∑–æ–≤—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É, –≤–∫–ª—é—á–∞—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ù–∞—à–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: —Ñ–æ–∫—É—Å –∏–º–µ–Ω–Ω–æ –Ω–∞ –≥–ª—É–±–æ–∫–æ–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –∞ –Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫–∞—Ö. –°—Å—ã–ª–∫–∞: https://gameanalytics.com/\n    *   Sentry / Bugsnag: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Ç—á–µ—Ç–∞—Ö –æ–± –æ—à–∏–±–∫–∞—Ö, –Ω–æ –∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∏–≥—Ä–æ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω. –ù–∞—à–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ \"–≤—Å–µ –≤ –æ–¥–Ω–æ–º\" –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–≥—Ä. –°—Å—ã–ª–∫–∞: https://sentry.io/for/gaming/\n\n6.  –û–ø—ã—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –≤–µ–±–∏–Ω–∞—Ä–æ–≤: –ú—ã –ø—Ä–æ–≤–µ–ª–∏ 2 –≤–µ–±–∏–Ω–∞—Ä–∞ –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–∞ —Ç–µ–º—É \"–ö–∞–∫ –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ—Å–∞–¥–∫–∏ FPS –≤ –º–æ–±–∏–ª—å–Ω–æ–π –∏–≥—Ä–µ –Ω–∞ Unity\".\n    *   –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: –°—É–º–º–∞—Ä–Ω–æ –±—ã–ª–æ –æ–∫–æ–ª–æ 350 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –∏ 150 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–Ω–ª–∞–π–Ω.\n    *   –ö–æ–Ω–≤–µ—Ä—Å–∏—è: –í —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–∞ —Ç—Ä–∏–∞–ª –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –æ–∫–æ–ª–æ 5% —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –ø–ª–∞—Ç—è—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ —Ç—Ä–∏–∞–ª–∞ —Å–æ—Å—Ç–∞–≤–∏–ª–∞ ~10% –æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–≤—à–∏—Ö—Å—è. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—á–∏—Ç–∞–µ–º —Å–∫—Ä–æ–º–Ω—ã–º, –≤–æ—Ä–æ–Ω–∫—É –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.\n\n7.  –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π –±—é–¥–∂–µ—Ç: –ú—ã –≥–æ—Ç–æ–≤—ã –≤—ã–¥–µ–ª–∏—Ç—å $15,000 –Ω–∞ –ø–µ—Ä–≤—ã–µ 3 –º–µ—Å—è—Ü–∞ ($5,000/–º–µ—Å—è—Ü). –ë—é–¥–∂–µ—Ç –≥–∏–±–∫–∏–π –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–≤–µ–ª–∏—á–µ–Ω –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π CAC (Customer Acquisition Cost).",
          "entities": [
            {
              "offset": 272,
              "length": 19,
              "type": "bold"
            },
            {
              "offset": 366,
              "length": 6,
              "type": "bold"
            },
            {
              "offset": 515,
              "length": 7,
              "type": "bold"
            },
            {
              "offset": 649,
              "length": 11,
              "type": "bold"
            },
            {
              "offset": 816,
              "length": 13,
              "type": "bold"
            },
            {
              "offset": 846,
              "length": 90,
              "type": "bold"
            },
            {
              "offset": 1138,
              "length": 18,
              "type": "bold"
            },
            {
              "offset": 1190,
              "length": 17,
              "type": "bold"
            },
            {
              "offset": 1430,
              "length": 17,
              "type": "bold"
            },
            {
              "offset": 1460,
              "length": 33,
              "type": "bold"
            },
            {
              "offset": 1587,
              "length": 16,
              "type": "bold"
            },
            {
              "offset": 1693,
              "length": 15,
              "type": "bold"
            },
            {
              "offset": 1855,
              "length": 19,
              "type": "bold"
            },
            {
              "offset": 1963,
              "length": 23,
              "type": "bold"
            },
            {
              "offset": 1995,
              "length": 13,
              "type": "bold"
            },
            {
              "offset": 2009,
              "length": 51,
              "type": "bold"
            },
            {
              "offset": 2210,
              "length": 13,
              "type": "bold"
            },
            {
              "offset": 2224,
              "length": 91,
              "type": "bold"
            },
            {
              "offset": 2449,
              "length": 11,
              "type": "bold"
            },
            {
              "offset": 2469,
              "length": 35,
              "type": "bold"
            },
            {
              "offset": 2620,
              "length": 49,
              "type": "code"
            },
            {
              "offset": 2678,
              "length": 14,
              "type": "bold"
            },
            {
              "offset": 2890,
              "length": 26,
              "type": "code"
            },
            {
              "offset": 2925,
              "length": 17,
              "type": "bold"
            },
            {
              "offset": 3135,
              "length": 29,
              "type": "code"
            },
            {
              "offset": 3170,
              "length": 26,
              "type": "bold"
            },
            {
              "offset": 3327,
              "length": 11,
              "type": "bold"
            },
            {
              "offset": 3408,
              "length": 10,
              "type": "bold"
            },
            {
              "offset": 3624,
              "length": 21,
              "type": "bold"
            },
            {
              "offset": 3665,
              "length": 26,
              "type": "bold"
            }
          ]
        }
      }
    ],
    "Brief Form": [
      {
        "–í –∫–∞–∫–æ–π –Ω–∏—à–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç?": "–π—Ü—É–∞",
        "–ö–∞–∫–æ–π —É –≤–∞—Å –ø—Ä–æ–¥—É–∫—Ç?": "–π—Ü—É–∞",
        "–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞": "–π—Ü—É–∞",
        "–û–ø–∏—à–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é": "–π—Ü—É–∞",
        "–°–∫–∏–Ω—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤": "–π—Ü—É–∞",
        "–ö–∞–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –≤–æ—Ä–æ–Ω–∫–∏ –¥–ª—è –≤–∞—Å –±—É–¥—É—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã?": [
          "ROAS –Ω–µ –º–µ–Ω–µ–µ 100%"
        ],
        "–ö–∞–∫–æ–π —É –≤–∞—Å –±—é–¥–∂–µ—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É?": "–π—Ü—É–∞",
        "–í –∫–∞–∫–∏—Ö –∫–∞–Ω–∞–ª–∞—Ö –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ç—Ä–∞—Ñ–∏–∫?": "–π—Ü—É–∞",
        "–ö–∞–∫–∏–µ –≤–æ—Ä–æ–Ω–∫–∏ —É–∂–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏?": "–π—Ü—É–∞",
        "–ë—ã–ª –ª–∏ –æ–ø—ã—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–≤–µ–±–∏–Ω–∞—Ä–æ–≤?": "–π—Ü—É–∞",
        "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏": "–π—Ü—É–∞",
        "chat_id": "212935169",
        "submittedAt": "2025-09-18T11:54:59.091-04:00",
        "formMode": "production",
        "formQueryParameters": {
          "chat_id": "212935169"
        }
      }
    ]
  },
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d19e1b26c0b8d95659d042a7491aa0358608320cfa3f09b4a3a78387d58037a3"
  }
}